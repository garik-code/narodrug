!function(a){SABAI.GoogleMaps=SABAI.GoogleMaps||{},SABAI.GoogleMaps.markerMap=SABAI.GoogleMaps.markerMap||function(e,o,s){var t,n,l,r,g=a(e),i=g.find(".sabai-googlemaps-address"),d=g.find(".sabai-googlemaps-map"),A=function(){return SABAI.GoogleMaps.markerMapAddress},p=function(){return l||(l=new google.maps.Geocoder),l},m=function(a){d.find(".sabai-googlemaps-map-zoom").val(t.getZoom()),d.find(".sabai-googlemaps-map-lat").val(a.lat()),d.find(".sabai-googlemaps-map-lng").val(a.lng()),u()},c=function(a){n.setPosition(a),n.setAnimation(google.maps.Animation.BOUNCE),window.setTimeout(function(){n.setAnimation(null),t.panTo(a),m(a)},1e3)},u=function(a){var e;e=n.getPosition(),e&&p().geocode({latLng:e},function(e,s){if(s==google.maps.GeocoderStatus.OK)if(e[0]){if(e[0].address_components){var t={};for(var n in e[0].address_components)"object"==typeof e[0].address_components[n]&&e[0].address_components[n].types[0]&&e[0].address_components[n].long_name&&(t[e[0].address_components[n].types[0]]={value:e[0].address_components[n].long_name,short_value:e[0].address_components[n].short_name})}var l=g.find(".sabai-googlemaps-formatted-address");!l.length||!a&&l.val()||l.val(e[0].formatted_address||""),i.find('[class^="sabai-googlemaps-address-"]').filter(":input:visible").val(""),A().setAddress(i,t,o)}else alert("Geocoder returned no address components");else alert("Geocoder failed due to: "+s)})},f=[];for(r in google.maps.MapTypeId)f.push(google.maps.MapTypeId[r]);if(f.push("osm"),t=new google.maps.Map(d.find(".sabai-googlemaps-map-map").get(0),{mapTypeControl:!0,mapTypeId:-1!==a.inArray(d.data("map-type"),f)?d.data("map-type"):google.maps.MapTypeId.ROADMAP,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.DROPDOWN_MENU,mapTypeIds:f},zoom:d.data("zoom"),center:new google.maps.LatLng(d.data("center-lat"),d.data("center-lng")),scrollwheel:!1,styles:null}),t.mapTypes.set("osm",new google.maps.ImageMapType({getTileUrl:function(a,e){return"//a.tile.openstreetmap.org/"+e+"/"+a.x+"/"+a.y+".png"},tileSize:new google.maps.Size(256,256),isPng:!0,maxZoom:19,minZoom:0,name:"OSM"})),n=new google.maps.Marker({map:t,draggable:!0,animation:google.maps.Animation.DROP}),d.data("lat")&&d.data("lng")&&n.setPosition(new google.maps.LatLng(d.data("lat"),d.data("lng"))),google.maps.event.addListener(t,"click",function(a){c(a.latLng)}),google.maps.event.addListener(t,"zoom_changed",function(a){d.find(".sabai-googlemaps-map-zoom").val(t.getZoom())}),google.maps.event.addListener(n,"dragend",function(a){window.setTimeout(function(){t.panTo(a.latLng),m(a.latLng)},1e3)}),d.find(".sabai-googlemaps-map-lat, .sabai-googlemaps-map-lng").change(function(){var a=d.find(".sabai-googlemaps-map-lat").val(),e=d.find(".sabai-googlemaps-map-lng").val();a&&e&&google.maps.event.trigger(t,"click",{latLng:new google.maps.LatLng(a,e)})}),d.find(".sabai-googlemaps-map-map").fitMaps(),g.find(".sabai-googlemaps-find-on-map").click(function(){var e=g.find(".sabai-googlemaps-formatted-address");return e.length?(p().geocode({address:a.trim(e.val())},function(a,e){e==google.maps.GeocoderStatus.OK?c(a[0].geometry.location):alert("Geocoder failed due to: "+e)}),!1):!1}),g.find(".sabai-googlemaps-get-from-map").click(function(){return u(!0),!1}),navigator.geolocation&&("https:"===document.location.protocol||"localhost"===document.location.hostname)){var v=g.find(".sabai-googlemaps-formatted-address");if(v.length){var b=a('<span style="position:absolute; right:0; cursor:pointer; width:24px; height:24px; padding:4px; margin-right:1px;"><img style="vertical-align:baseline !important;" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQBAMAAADt3eJSAAAAA3NCSVQICAjb4U/gAAAACXBIWXMAAAA/AAAAPwFHl4ngAAAAGXRFWHRTb2Z0d2FyZQB3d3cuaW5rc2NhcGUub3Jnm+48GgAAADBQTFRF////AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAL92gewAAAA90Uk5TAAYTOklcfYiNkZ+oueHn8F/YJAAAAE9JREFUCFtjYGBgYC9ggAAYg7n3hgGIZpyX4vZSAMjgPBS1VGcCkGGn/f//psdARlv8//9fMxgYyq+s////l285ggGXQiiGa4cbCLcC3XYA7R8qgYIYH20AAAAASUVORK5CYII6c7cb9f3bd9ed4aaf8b60b0d7d242d61="/></span>');b.insertAfter(v);var M=(v.outerHeight()-b.outerHeight())/2+parseInt(v.css("margin-top"));b.css("top",M+"px").click(function(e){var o=a(this);return SABAI.ajaxLoader(v),l=new google.maps.Geocoder,navigator.geolocation.getCurrentPosition(function(a){l.geocode({latLng:new google.maps.LatLng(a.coords.latitude,a.coords.longitude)},function(e,s){SABAI.ajaxLoader(o,!0),s==google.maps.GeocoderStatus.OK&&(v.val(e[0].formatted_address).effect("highlight",{},2e3),c(new google.maps.LatLng(a.coords.latitude,a.coords.longitude)))}),SABAI.ajaxLoader(v,!0)},function(a){SABAI.ajaxLoader(v,!0),SABAI.flash(a.message,"danger"),SABAI.console.log(a.message+" ("+a.code+")")},{enableHighAccuracy:!0,timeout:5e3}),!1})}}s&&a(SABAI).bind("clonefield.sabai",function(a,e){(e.clone.hasClass("sabai-form-type-googlemaps-marker")||e.clone.hasClass("sabai-googlemaps-form-container"))&&(e.clone.find(".sabai-googlemaps-map").data("lat",null).data("lng",null),SABAI.GoogleMaps.markerMap(e.clone,o,!1))})},SABAI.GoogleMaps.markerMapAddress={_loadVal:function(a,e,o){var s=a.find(o);"select"===s.get(0).tagName.toLowerCase()?s.val(e.short_value):s.val(e.value)},_setAddress:function(a,e,o){var s;e.street_address?s=e.street_address.val():e.route&&(s=e.street_number?e.street_number.value+" "+e.route.value:e.route.value),a.find(".sabai-googlemaps-address-street").val(s)},setAddress:function(a,e,o){var s;for(var t in e)switch(t){case"sublocality":case"locality":SABAI.GoogleMaps.markerMapAddress._loadVal(a,e[t],".sabai-googlemaps-address-city");break;case"administrative_area_level_1":SABAI.GoogleMaps.markerMapAddress._loadVal(a,e[t],".sabai-googlemaps-address-province");break;case"postal_code":SABAI.GoogleMaps.markerMapAddress._loadVal(a,e[t],".sabai-googlemaps-address-zip");break;case"country":s=e[t].short_value,SABAI.GoogleMaps.markerMapAddress._loadVal(a,e[t],".sabai-googlemaps-address-country")}s&&SABAI.GoogleMaps.markerMapAddress[s]&&SABAI.GoogleMaps.markerMapAddress[s].setAddress?SABAI.GoogleMaps.markerMapAddress[s].setAddress(a,e,o):SABAI.GoogleMaps.markerMapAddress._setAddress(a,e,o)},JP:{setAddress:function(a,e,o){var s,t="",n="",l="",r="",g="",i="";for(var d in e)switch(d){case"ward":t=e[d].value;break;case"sublocality_level_1":n=e[d].value;break;case"sublocality_level_2":l=e[d].value;break;case"sublocality_level_3":r=e[d].value;break;case"sublocality_level_4":g=e[d].value;break;case"sublocality_level_5":i=e[d].value}s="ja"===o?t+n+l+[r,g,i].filter(Boolean).join("繝ｼ"):[t,n,l,[r,g,i].filter(Boolean).join("-")].filter(Boolean).join(" "),a.find(".sabai-googlemaps-address-street").val(s)}}}}(jQuery);